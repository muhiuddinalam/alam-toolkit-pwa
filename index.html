<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Install AlamToolKit App</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#ff6b35">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AlamToolKit">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #ff6b35 0%, #ff3e3e 100%);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }
        
        .container {
            max-width: 600px;
            width: 100%;
            padding: 40px 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(255, 107, 53, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .icon-large {
            font-size: 80px;
            margin-bottom: 20px;
            display: block;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        /* Install Button Styles */
        .install-btn {
            background: white;
            color: #ff6b35;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            min-width: 220px;
            justify-content: center;
        }
        
        .install-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
        }
        
        .install-btn:active {
            transform: translateY(-1px);
        }
        
        .btn-icon {
            font-size: 24px;
        }
        
        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .feature {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px 15px;
            border-radius: 15px;
            transition: all 0.3s ease;
        }
        
        .feature:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        
        .feature-text {
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        /* Instructions */
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: left;
        }
        
        .instructions h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ol {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        /* Alternative Button */
        .alt-btn {
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .alt-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: white;
        }
        
        /* Status Messages */
        .status-message {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            display: none;
        }
        
        .success {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .error {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        /* Platform-specific instructions */
        .platform-instructions {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1.1rem;
            }
            
            .install-btn {
                padding: 16px 35px;
                font-size: 1.1rem;
                min-width: 200px;
            }
            
            .features-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .feature {
                padding: 15px 10px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 25px 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .icon-large {
                font-size: 60px;
            }
            
            .install-btn {
                padding: 14px 30px;
                font-size: 1rem;
                min-width: 180px;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .instructions {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="icon-large">üöÄ</div>
        
        <h1>Install AlamToolKit App</h1>
        
        <p class="subtitle">
            Get the enhanced experience with faster loading, offline access, and push notifications
        </p>
        
        <!-- Install Button -->
        <button id="installButton" class="install-btn">
            <span class="btn-icon">üì±</span>
            <span class="btn-text">Install App</span>
        </button>
        
        <!-- Status Messages -->
        <div id="successMessage" class="status-message success">
            ‚úÖ App installed successfully! Opening AlamToolKit...
        </div>
        
        <div id="errorMessage" class="status-message error">
            ‚ùå Installation failed. Please try again or use manual installation.
        </div>
        
        <!-- Features Grid -->
        <div class="features-grid">
            <div class="feature">
                <span class="feature-icon">‚ö°</span>
                <span class="feature-text">60% Faster</span>
            </div>
            <div class="feature">
                <span class="feature-icon">üì∂</span>
                <span class="feature-text">Works Offline</span>
            </div>
            <div class="feature">
                <span class="feature-icon">üîî</span>
                <span class="feature-text">Push Alerts</span>
            </div>
            <div class="feature">
                <span class="feature-icon">üíæ</span>
                <span class="feature-text">Saves Data</span>
            </div>
        </div>
        
        <!-- Platform-specific Instructions -->
        <div id="iosInstructions" class="platform-instructions">
            <h3><span>üì±</span> iOS Installation</h3>
            <ol>
                <li>Tap the <strong>Share</strong> button <span style="font-size: 18px">‚éô</span> in Safari</li>
                <li>Scroll down and tap <strong>"Add to Home Screen"</strong></li>
                <li>Tap <strong>"Add"</strong> in the top right corner</li>
            </ol>
        </div>
        
        <div id="androidInstructions" class="platform-instructions">
            <h3><span>ü§ñ</span> Android Installation</h3>
            <ol>
                <li>Tap the <strong>Menu</strong> button (‚ãÆ) in Chrome</li>
                <li>Tap <strong>"Add to Home screen"</strong></li>
                <li>Tap <strong>"Add"</strong> to install</li>
            </ol>
        </div>
        
        <!-- Instructions -->
        <div class="instructions">
            <h3><span>üìù</span> Installation Guide</h3>
            <ol>
                <li>Click the <strong>"Install App"</strong> button above</li>
                <li>Follow your browser's installation prompt</li>
                <li>Find the app icon on your home screen</li>
                <li>Open AlamToolKit anytime - even offline!</li>
            </ol>
        </div>
        
        <!-- Alternative Option -->
        <a href="https://www.alamtoolkit.com" class="alt-btn">
            Continue to Main Site ‚Üí
        </a>
    </div>

    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('‚úÖ Service Worker registered:', registration);
                })
                .catch(error => {
                    console.log('‚ùå Service Worker registration failed:', error);
                });
        }
    </script>

    <!-- PWA Installation Logic -->
    <script>
        // DOM Elements
        const installButton = document.getElementById('installButton');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const iosInstructions = document.getElementById('iosInstructions');
        const androidInstructions = document.getElementById('androidInstructions');
        
        // Platform Detection
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        
        // Check if app is already installed
        function isAppInstalled() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true ||
                   document.referrer.includes('android-app://');
        }
        
        // Variables
        let deferredPrompt = null;
        let installPromptShown = false;
        
        // 1. Listen for beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('‚úÖ beforeinstallprompt event fired');
            
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Update UI to show install button is available
            installButton.style.display = 'inline-flex';
            installButton.disabled = false;
            installPromptShown = true;
            
            // Update button text
            installButton.innerHTML = '<span class="btn-icon">üì±</span><span class="btn-text">Install App</span>';
            
            // Show platform instructions if no prompt available
            if (!deferredPrompt) {
                showPlatformInstructions();
            }
        });
        
        // 2. Handle install button click
        installButton.addEventListener('click', async () => {
            console.log('Install button clicked');
            
            if (deferredPrompt) {
                // Show the install prompt
                installButton.innerHTML = '<span class="btn-icon">‚è≥</span><span class="btn-text">Installing...</span>';
                installButton.disabled = true;
                
                try {
                    deferredPrompt.prompt();
                    
                    // Wait for the user to respond to the prompt
                    const choiceResult = await deferredPrompt.userChoice;
                    
                    if (choiceResult.outcome === 'accepted') {
                        console.log('‚úÖ User accepted the install prompt');
                        showSuccess();
                        
                        // Set flag in localStorage
                        localStorage.setItem('alamtoolkit_installed', 'true');
                        
                        // Redirect to main site after 2 seconds
                        setTimeout(() => {
                            window.location.href = 'https://www.alamtoolkit.com';
                        }, 2000);
                    } else {
                        console.log('‚ùå User dismissed the install prompt');
                        showPlatformInstructions();
                        installButton.innerHTML = '<span class="btn-icon">üì±</span><span class="btn-text">Try Again</span>';
                        installButton.disabled = false;
                    }
                    
                    // Clear the deferredPrompt variable
                    deferredPrompt = null;
                    
                } catch (error) {
                    console.error('Installation error:', error);
                    showError();
                    installButton.innerHTML = '<span class="btn-icon">üì±</span><span class="btn-text">Try Again</span>';
                    installButton.disabled = false;
                }
            } else {
                // No deferred prompt available
                console.log('No install prompt available');
                showPlatformInstructions();
            }
        });
        
        // 3. Show success message
        function showSuccess() {
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
            installButton.style.display = 'none';
        }
        
        // 4. Show error message
        function showError() {
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
        }
        
        // 5. Show platform-specific instructions
        function showPlatformInstructions() {
            if (isIOS) {
                iosInstructions.style.display = 'block';
                androidInstructions.style.display = 'none';
            } else if (isAndroid) {
                androidInstructions.style.display = 'block';
                iosInstructions.style.display = 'none';
            } else {
                // Show both for desktop
                iosInstructions.style.display = 'block';
                androidInstructions.style.display = 'block';
            }
            
            installButton.innerHTML = '<span class="btn-icon">üì±</span><span class="btn-text">Manual Install</span>';
            installButton.onclick = () => {
                showPlatformInstructions();
                return false;
            };
        }
        
        // 6. Check on page load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, checking install status');
            
            // Check if already installed
            if (isAppInstalled()) {
                console.log('App is already installed, redirecting...');
                window.location.href = 'https://www.alamtoolkit.com';
                return;
            }
            
            // Check if previously installed via localStorage
            if (localStorage.getItem('alamtoolkit_installed') === 'true') {
                console.log('App was previously installed, redirecting...');
                window.location.href = 'https://www.alamtoolkit.com';
                return;
            }
            
            // Show install button after a delay if prompt wasn't shown
            setTimeout(() => {
                if (!installPromptShown) {
                    installButton.style.display = 'inline-flex';
                    showPlatformInstructions();
                }
            }, 1000);
        });
        
        // 7. Listen for appinstalled event
        window.addEventListener('appinstalled', (evt) => {
            console.log('‚úÖ App was installed via appinstalled event');
            localStorage.setItem('alamtoolkit_installed', 'true');
            
            // Hide install button
            installButton.style.display = 'none';
            
            // Show success message
            showSuccess();
            
            // Redirect after delay
            setTimeout(() => {
                window.location.href = 'https://www.alamtoolkit.com';
            }, 2000);
        });
        
        // 8. Check for standalone mode changes
        window.matchMedia('(display-mode: standalone)').addEventListener('change', (e) => {
            if (e.matches) {
                console.log('App is now in standalone mode');
                window.location.href = 'https://www.alamtoolkit.com';
            }
        });
    </script>
</body>
</html>
