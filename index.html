<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Install AlamToolKit PWA</title>
    <meta name="description" content="Install AlamToolKit Progressive Web App for enhanced experience with 300+ productivity tools">
    
    <!-- PWA Manifest (CRITICAL FIX: Use absolute URL) -->
    <link rel="manifest" href="https://muhiuddinalam.github.io/alam-toolkit-pwa/manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="icons/icon-192.png">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#ff6b35">
    
    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AlamToolKit">
    
    <!-- Windows PWA Meta Tags -->
    <meta name="msapplication-TileColor" content="#ff6b35">
    <meta name="msapplication-TileImage" content="icons/icon-192.png">
    <meta name="msapplication-starturl" content="https://www.alamtoolkit.com/">
    
    <style>
        /* Your existing CSS styles - keep them */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; line-height: 1.6; color: #333; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .container { max-width: 800px; width: 100%; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #ff6b35 0%, #ff3e3e 100%); color: white; text-align: center; padding: 40px 20px; }
        .header-icon { font-size: 60px; margin-bottom: 20px; display: block; }
        h1 { font-size: 2.5rem; margin-bottom: 10px; font-weight: 800; }
        .subtitle { font-size: 1.2rem; opacity: 0.9; max-width: 600px; margin: 0 auto; }
        .content { padding: 40px; }
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0; }
        .feature-card { background: #f8f9fa; padding: 25px; border-radius: 12px; text-align: center; border-left: 4px solid #ff6b35; transition: all 0.3s ease; }
        .feature-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(255, 107, 53, 0.15); }
        .feature-icon { font-size: 40px; margin-bottom: 15px; display: block; }
        .feature-title { font-size: 1.3rem; font-weight: 600; margin-bottom: 10px; color: #2c3e50; }
        .feature-description { color: #666; font-size: 0.95rem; }
        .install-section { text-align: center; margin: 40px 0; padding: 30px; background: linear-gradient(135deg, rgba(255, 107, 53, 0.1) 0%, rgba(255, 62, 62, 0.1) 100%); border-radius: 15px; }
        .install-btn { background: linear-gradient(135deg, #ff6b35 0%, #ff3e3e 100%); color: white; border: none; padding: 18px 40px; border-radius: 50px; font-size: 1.2rem; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 12px; transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3); margin: 20px 0; }
        .install-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4); }
        .install-btn.installed { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); }
        .install-btn.installing { background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%); }
        .btn-icon { font-size: 24px; }
        .instructions { background: white; border-radius: 12px; padding: 25px; margin: 30px 0; border: 2px solid #e9ecef; }
        .instructions h3 { color: #2c3e50; margin-bottom: 20px; text-align: center; font-size: 1.5rem; }
        .instruction-steps { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .step { background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; }
        .step-number { background: #ff6b35; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-weight: bold; }
        .goto-main { text-align: center; margin-top: 40px; padding-top: 30px; border-top: 1px solid #eee; }
        .main-btn { display: inline-block; background: white; color: #ff6b35; border: 2px solid #ff6b35; padding: 15px 35px; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 1.1rem; transition: all 0.3s ease; }
        .main-btn:hover { background: #ff6b35; color: white; transform: translateY(-3px); }
        .footer { text-align: center; padding: 30px; color: #666; font-size: 0.9rem; border-top: 1px solid #eee; }
        @media (max-width: 768px) { h1 { font-size: 2rem; } .subtitle { font-size: 1rem; } .content { padding: 20px; } .install-btn { padding: 16px 32px; font-size: 1.1rem; } .instruction-steps { grid-template-columns: 1fr; } }
        @media (max-width: 480px) { .header { padding: 30px 15px; } h1 { font-size: 1.8rem; } .install-btn { padding: 14px 28px; font-size: 1rem; } }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <span class="header-icon">üì±</span>
            <h1>Install AlamToolKit PWA</h1>
            <p class="subtitle">Get faster loading, offline access, and app-like experience for 300+ productivity tools</p>
        </div>
        
        <!-- Content Section -->
        <div class="content">
            <!-- Features Grid -->
            <div class="features-grid">
                <div class="feature-card">
                    <span class="feature-icon">‚ö°</span>
                    <h3 class="feature-title">Fast Loading</h3>
                    <p class="feature-description">60% faster than regular website with cached resources</p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">üì∂</span>
                    <h3 class="feature-title">Works Offline</h3>
                    <p class="feature-description">Access essential tools even without internet connection</p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">üîî</span>
                    <h3 class="feature-title">Push Notifications</h3>
                    <p class="feature-description">Get updates about new tools and features</p>
                </div>
                
                <div class="feature-card">
                    <span class="feature-icon">üíæ</span>
                    <h3 class="feature-title">Saves Data</h3>
                    <p class="feature-description">Reduced data usage with intelligent caching</p>
                </div>
            </div>
            
            <!-- Install Section -->
            <div class="install-section">
                <h2>One-Click Installation</h2>
                <p>Install AlamToolKit as a native app on your device</p>
                
                <button id="installButton" class="install-btn">
                    <span class="btn-icon">üì±</span>
                    <span>Install AlamToolKit App</span>
                </button>
                
                <div id="installStatus" style="margin-top: 15px; font-size: 0.9rem; color: #666;"></div>
            </div>
            
            <!-- Instructions -->
            <div class="instructions">
                <h3>üìù Installation Instructions</h3>
                <div class="instruction-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h4>Chrome/Edge Desktop</h4>
                        <p>Click "Install" button or look for install icon in address bar</p>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <h4>Chrome Android</h4>
                        <p>Tap menu (‚ãÆ) ‚Üí "Add to Home screen"</p>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <h4>Safari iOS</h4>
                        <p>Tap Share (‚éô) ‚Üí "Add to Home Screen" ‚Üí "Add"</p>
                    </div>
                </div>
            </div>
            
            <!-- Go to Main Site -->
            <div class="goto-main">
                <h3>All 300+ Tools Available on Main Site</h3>
                <p>After installation, the app will open the main AlamToolKit website</p>
                <a href="https://www.alamtoolkit.com" class="main-btn" target="_blank">
                    <span>üåê</span> Visit www.alamtoolkit.com
                </a>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>¬© AlamToolKit.com. All rights reserved.</p>
            <p>300+ free online tools for daily productivity</p>
            <p>Contact: <a href="mailto:muhiuddinalam@gmail.com">muhiuddinalam@gmail.com</a></p>
        </div>
    </div>

    <!-- FIXED PWA Installation JavaScript -->
    <script>
        // DOM Elements
        const installButton = document.getElementById('installButton');
        const installStatus = document.getElementById('installStatus');
        
        // Variables
        let deferredPrompt = null;
        let isInstalled = false;
        
        // Enhanced browser detection
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
        const isEdge = /Edg/.test(navigator.userAgent);
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // Check if PWA is already installed
        function checkIfPWAInstalled() {
            // Check display mode
            if (window.matchMedia('(display-mode: standalone)').matches) {
                return true;
            }
            
            // Check iOS standalone
            if (window.navigator.standalone === true) {
                return true;
            }
            
            // Check localStorage
            if (localStorage.getItem('alam_pwa_installed') === 'true') {
                return true;
            }
            
            return false;
        }
        
        // Update install button state
        function updateInstallButton() {
            isInstalled = checkIfPWAInstalled();
            
            if (isInstalled) {
                installButton.innerHTML = '<span class="btn-icon">‚úÖ</span><span>Already Installed</span>';
                installButton.classList.add('installed');
                installButton.disabled = true;
                installStatus.innerHTML = '<span style="color: #27ae60;">‚úÖ AlamToolKit is installed on your device</span>';
                return;
            }
            
            // Show appropriate instructions
            if (isIOS && isSafari) {
                installStatus.innerHTML = 'üì± <strong>On iPhone/iPad:</strong> Tap Share (‚éô) ‚Üí "Add to Home Screen" ‚Üí "Add"';
            } else if (isChrome || isEdge) {
                installStatus.innerHTML = '‚úÖ <strong>Click the Install button above</strong> to add to your device';
            } else {
                installStatus.innerHTML = 'üì± <strong>Look for the install option</strong> in your browser menu';
            }
        }
        
        // Show message
        function showMessage(message, type = 'info') {
            const colors = {
                success: '#27ae60',
                error: '#e74c3c',
                info: '#3498db'
            };
            
            installStatus.innerHTML = `<span style="color: ${colors[type]}">${message}</span>`;
            
            if (type !== 'success') {
                setTimeout(() => updateInstallButton(), 5000);
            }
        }
        
        // Show iOS installation instructions
        function showiOSInstructions() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    padding: 30px;
                    border-radius: 20px;
                    max-width: 400px;
                    width: 100%;
                    text-align: center;
                ">
                    <div style="font-size: 48px; margin-bottom: 20px;">üì±</div>
                    <h3 style="margin: 0 0 15px 0; color: #333;">Install AlamToolKit on iPhone/iPad</h3>
                    <div style="text-align: left; margin: 20px 0;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 10px;">
                            <div style="background: #ff6b35; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold;">1</div>
                            <div>Tap the <strong>Share</strong> button <span style="font-size: 20px;">‚éô</span></div>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 10px;">
                            <div style="background: #ff6b35; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold;">2</div>
                            <div>Scroll down and tap <strong>"Add to Home Screen"</strong></div>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 10px;">
                            <div style="background: #ff6b35; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold;">3</div>
                            <div>Tap <strong>"Add"</strong> in the top right corner</div>
                        </div>
                    </div>
                    <button id="closeModal" style="
                        background: #ff6b35;
                        color: white;
                        border: none;
                        padding: 12px 30px;
                        border-radius: 25px;
                        font-weight: bold;
                        cursor: pointer;
                        margin-top: 10px;
                    ">
                        Got It, Thanks!
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('closeModal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
        
        // Handle install button click
        async function handleInstallClick() {
            if (isInstalled) {
                showMessage('‚úÖ AlamToolKit is already installed on your device!', 'success');
                return;
            }
            
            // iOS Safari - show special instructions
            if (isIOS && isSafari) {
                showiOSInstructions();
                return;
            }
            
            // Chrome/Edge/Android - try native installation
            if (deferredPrompt) {
                try {
                    installButton.innerHTML = '<span class="btn-icon">‚è≥</span><span>Installing...</span>';
                    installButton.classList.add('installing');
                    installButton.disabled = true;
                    
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        // Installation successful
                        localStorage.setItem('alam_pwa_installed', 'true');
                        isInstalled = true;
                        
                        showMessage('üéâ AlamToolKit installed successfully! Opening main site...', 'success');
                        
                        // Redirect to main site after 2 seconds
                        setTimeout(() => {
                            window.location.href = 'https://www.alamtoolkit.com';
                        }, 2000);
                    } else {
                        // Installation declined
                        showMessage('Installation cancelled. You can install later.', 'info');
                        installButton.innerHTML = '<span class="btn-icon">üì±</span><span>Install AlamToolKit App</span>';
                        installButton.classList.remove('installing');
                        installButton.disabled = false;
                    }
                    
                    deferredPrompt = null;
                } catch (error) {
                    console.error('Installation error:', error);
                    showMessage('Installation failed. Please try again.', 'error');
                    installButton.innerHTML = '<span class="btn-icon">üì±</span><span>Install AlamToolKit App</span>';
                    installButton.classList.remove('installing');
                    installButton.disabled = false;
                }
            } else {
                // No deferredPrompt available - show manual instructions
                if (isChrome || isEdge) {
                    showMessage('üîß Please look for the install icon in your address bar (desktop) or browser menu (mobile)', 'info');
                } else {
                    showMessage('üì± Check your browser menu for "Add to Home Screen" or "Install App" option', 'info');
                }
            }
        }
        
        // Initialize
        function initialize() {
            console.log('Initializing PWA installer...');
            console.log('Browser info:', {
                isIOS, isSafari, isChrome, isEdge, isMobile,
                userAgent: navigator.userAgent
            });
            
            // Check initial state
            updateInstallButton();
            
            // Listen for beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('‚úÖ beforeinstallprompt event fired!');
                e.preventDefault();
                deferredPrompt = e;
                
                // Update status
                installStatus.innerHTML = '‚úÖ <strong>Installation available!</strong> Click the button above.';
            });
            
            // Listen for app installed event
            window.addEventListener('appinstalled', () => {
                console.log('üéâ App installed event fired');
                localStorage.setItem('alam_pwa_installed', 'true');
                isInstalled = true;
                updateInstallButton();
            });
            
            // Add click listener
            installButton.addEventListener('click', handleInstallClick);
            
            // Check again after 2 seconds
            setTimeout(updateInstallButton, 2000);
        }
        
        // Start when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }
        
        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
